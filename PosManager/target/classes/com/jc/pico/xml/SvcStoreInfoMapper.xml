<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jc.pico.mapper.SvcStoreInfoMapper">

  <resultMap id="BaseResultMap"  type="com.jc.pico.bean.SvcStoreInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Dec 23 11:41:46 KST 2016.
    -->
    <result column="PG_MERCHANT_ID"  jdbcType="VARCHAR"  property="pgMerchantId" />
    <result column="PG_PRIVATE_KEY"     jdbcType="VARCHAR"  property="pgPrivateKey" />
    <result column="PG_PAYMENT_KEY"  jdbcType="VARCHAR"   property="pgPaymentKey" />
    <collection property="printers" javaType="java.util.List" ofType="com.jc.pico.bean.SvcStoreInfoPrinter" >
	    <result column="IP" jdbcType="VARCHAR" property="ip" />
	    <result column="IP_PORT" jdbcType="VARCHAR" property="ipPort" />
	    <result column="POS_NO" jdbcType="VARCHAR" property="posNo" />
	    <result column="PRINTER_NO" jdbcType="VARCHAR" property="printerNo" />
    </collection>
  </resultMap>


  <select id="selectMerchantAndPrinter"  parameterType="HashMap"  resultMap="BaseResultMap">
	SELECT IF (A.ALLOW_STORE_SET = 1, A.PG_MERCHANT_ID_STORE, A.PG_MERCHANT_ID_BRAND) AS PG_MERCHANT_ID, 
	            A.PG_PRIVATE_KEY AS PG_PRIVATE_KEY, A.PG_PAYMENT_KEY AS PG_PAYMENT_KEY,
		       A.IP AS IP, A.IP_PORT AS IP_PORT, A.PRINTER_NO AS PRINTER_NO, A.POS_NO AS POS_NO  
	 FROM (
			SELECT B.PG_MERCHANT_ID AS PG_MERCHANT_ID_BRAND, B.PG_PRIVATE_KEY AS PG_PRIVATE_KEY, B.PG_PAYMENT_KEY AS PG_PAYMENT_KEY,
				   P.IP AS IP, P.IP_PORT AS IP_PORT, P.PRINTER_NO AS PRINTER_NO, P.POS_NO AS POS_NO,
				   (SELECT c.ALLOW_STORE_SET FROM tb_svc_brand c     WHERE c.ID = #{brandId, jdbcType=BIGINT} ) AS ALLOW_STORE_SET, 
				   (SELECT s.PG_MERCHANT_ID  FROM tb_svc_store_set s WHERE s.BRAND_ID = #{brandId, jdbcType=BIGINT} AND s.STORE_ID = #{storeId, jdbcType=BIGINT} ) AS PG_MERCHANT_ID_STORE 
			  FROM tb_svc_brand_set B LEFT OUTER JOIN tb_svc_store_printer P ON P.BRAND_ID = B.BRAND_ID AND P.STORE_ID = #{storeId, jdbcType=BIGINT} AND P.IS_USED = 1 
			 WHERE B.BRAND_ID  = #{brandId, jdbcType=BIGINT}) A
  </select>
  
  <select id="selectDeviceLicenseIsMain"  parameterType="HashMap"  resultType="singlemap">
	SELECT
		IS_MAIN
	 FROM
	 	TB_SVC_DEVICE_LICENSE
	 WHERE
	 	ID = #{licenseId, jdbcType=BIGINT}
  </select>
  
</mapper>